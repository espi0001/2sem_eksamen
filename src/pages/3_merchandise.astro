---
import "../styles/style.css";
import MainLayout from "../layouts/MainLayout.astro";
import Header2 from "../components/Header2.astro";
import Produkt from "../components/Produkt.astro";
import Breadcrumb2 from "../components/Breadcrumb2.astro";
import Navigation from "../components/Navigation.astro";

const apiUrl = "https://orihtpvviiwcpmwzboqr.supabase.co/rest/v1/ekamen";
const apiKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yaWh0cHZ2aWl3Y3Btd3pib3FyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTYzNjY0NzEsImV4cCI6MjAzMTk0MjQ3MX0.D3VmybLu_cJTAhpmkfHnKtssujUzP4qg3XDV1owo6Cw";

// Fetch data from Supabase ordered by the saved shuffled order
let data = [];
try {
  const response = await fetch(apiUrl, {
    method: "GET",
    headers: {
      apikey: apiKey,
    },
  });

  console.log("Response status:", response.status); // Debugging: Check response status
  data = await response.json();
  console.log("Fetched data:", data); // Debugging: Log fetched data

  if (!Array.isArray(data)) {
    throw new Error("Fetched data is not an array");
  }
} catch (error) {
  console.error("Error fetching or processing data:", error);
  data = []; // Ensure data is an empty array in case of error
}
---

<script>
  // Navigate to single view of the product with product data
  function openProductSingleView(product) {
    const url = `/pages/singleview.astro?name=${encodeURIComponent(product.name)}&price=${encodeURIComponent(product.price)}&image=${encodeURIComponent(product.image)}&about=${encodeURIComponent(product.about)}&material=${encodeURIComponent(product.material)}&weight=${encodeURIComponent(product.weight)}&more=${encodeURIComponent(product.more)}&obs=${encodeURIComponent(product.obs)}&size=${encodeURIComponent(product.size)}&status=${encodeURIComponent(product.status)}&tracklist=${encodeURIComponent(product.tracklist)}`;
    window.location.href = url;
  }
</script>

<MainLayout title="Merchandise">
  <Navigation />
  <main>
    <section>
      <Header2 header1="Merchandise" text="" />
      <article class="breadcrumb_button">
        <Breadcrumb2 navn1="TÃ¸j" navn2="Accessories" navn3="Musik" navn4="Poster" />
      </article>
    </section>

    <section class="produkter">
      {data.length > 0 ? data.map((product) => <Produkt images={product.image} name={product.name} type2={product.type2} price={product.price} />) : <p>No products available.</p>}
    </section>
  </main>
</MainLayout>

<style>
  h1 {
    padding-bottom: 48px;
    text-align: center;
  }
  .breadcrumb_button {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .produkter {
    display: grid;
    justify-content: center;
    margin-top: 32px;
  }
  @media screen and (min-width: 768px) {
    h1 {
      text-align: start;
    }

    .breadcrumb_button {
      justify-content: space-between;
    }

    .produkter {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 32px;
      justify-content: center;
      margin-top: 0px;
    }
  }
  @media screen and (min-width: 1024px) {
    .produkter {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 32px;
      justify-content: center;
    }
  }
</style>
